

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vehicle Control Unit &mdash; NTU Racing Team Zephyr Common Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Survey" href="survey.html" />
    <link rel="prev" title="Architecture Principles" href="principles.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Architecture</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Architecture</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#hardware-overview">Hardware Overview</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="principles.html">Architecture Principles</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Vehicle Control Unit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#architecture">Architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-flow">Data Flow</a></li>
<li class="toctree-l4"><a class="reference internal" href="#state-transition-diagram">State Transition Diagram</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="survey.html">Survey</a></li>
<li class="toctree-l3"><a class="reference internal" href="sensing.html">Sensing System</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="decisions/index.html">Architecture Decision Records</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Libraries</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../library/index.html">Common Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../library/vcu/index.html">VCU Library</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../develop/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/doxygen.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/test.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/notes/index.html">Developer’s Note</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop/doc.html">Doc Implementation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NTU Racing Team Zephyr Common</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Architecture</a></li>
      <li class="breadcrumb-item active">Vehicle Control Unit</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/architecture/vehicle_control_unit.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="vehicle-control-unit">
<span id="architecture-vehicle-control-unit"></span><h1>Vehicle Control Unit<a class="headerlink" href="#vehicle-control-unit" title="Link to this heading"></a></h1>
<section id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Link to this heading"></a></h2>
<p>The Vehicle Control Unit (VCU) is architected in a layered manner to ensure
modularity and maintainability. Most of the drivers and the middlewares are
provided by Zephyr, with only parts in blue being implemented by us.</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="../_images/architecture.svg"><img alt="../_images/architecture.svg" src="../_images/architecture.svg" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-text">The architecture of the VCU.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="data-flow">
<h2>Data Flow<a class="headerlink" href="#data-flow" title="Link to this heading"></a></h2>
<p>The system’s data mainly comes from the sensors and CAN Open, which is
aggregated first into appropriate <a class="reference external" href="https://nturacingteam.github.io/nturt_zephyr_common/doxygen/group__msg__interface.html">messages types</a>
using <a class="reference internal" href="../library/aggregation.html#library-aggregation"><span class="std std-ref">Data Aggregation</span></a> and then published to Zephyr <a class="reference external" href="https://docs.zephyrproject.org/4.2.0/services/zbus/index.html">Zbus</a>. CAN Open may
also send commands to change the state of the system, the parameters of the
control algorithms, etc., which is handled by <a class="reference internal" href="../library/command.html#library-command"><span class="std std-ref">Command System</span></a> and then
dispatched to appropriate modules via function calls. Finally, in order to
transmit telemetry data, <a class="reference internal" href="../library/telemetry.html#library-telemetry"><span class="std std-ref">Telemetry System</span></a> is used as the broker to
receive messages from Zbus for various backend protocols, including data
logginger, to publish.</p>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../_images/data_flow_diagram.svg"><img alt="../_images/data_flow_diagram.svg" src="../_images/data_flow_diagram.svg" style="width: 75%;" />
</a>
<figcaption>
<p><span class="caption-text">The data flow diagram of the VCU.</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="state-transition-diagram">
<h2>State Transition Diagram<a class="headerlink" href="#state-transition-diagram" title="Link to this heading"></a></h2>
<p><a class="reference internal" href="../library/vcu/states.html#library-vcu-states"><span class="std std-ref">State Machine</span></a> uses Zephyr <a class="reference external" href="https://docs.zephyrproject.org/4.2.0/services/smf/index.html">state machine framework</a>, which is based
on <a class="reference external" href="https://en.wikipedia.org/wiki/UML_state_machine#Hierarchically_nested_states">Hierarchical state machine</a>,
to manage the complex state transitions of VCU’s control system. Here the black
filled circles represent the initial state and the initial state transition of
the state machine, meaning which substate to enter when transitioning to the
parent state. So the initial state of the VCU is <code class="docutils literal notranslate"><span class="pre">RTD_BLINK</span></code>.</p>
<figure class="align-center" id="id3">
<a class="reference internal image-reference" href="../_images/state_transition_diagram.svg"><img alt="../_images/state_transition_diagram.svg" src="../_images/state_transition_diagram.svg" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-text"><a class="reference external" href="https://sparxsystems.com/resources/tutorials/uml2/state-diagram.html">UML state diagram</a> of
the VCU.</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="principles.html" class="btn btn-neutral float-left" title="Architecture Principles" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="survey.html" class="btn btn-neutral float-right" title="Survey" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, NTU Racing Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>